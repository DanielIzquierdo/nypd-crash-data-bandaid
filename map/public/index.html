<!DOCTYPE HTML>
<html>
    <head>
        <title>NYC Crashmapper</title>
        <link rel="stylesheet" href="/css/leaflet.css" />
        <link rel="stylesheet" href="/css/letsmap.css" />
        <link rel="stylesheet" href="/css/MarkerCluster.css" />
        <link rel="stylesheet" href="/css/MarkerCluster.Default.css" />
        <link rel="stylesheet" href="/css/smoothness/jquery-ui-1.10.3.custom.css" />

        <script type="text/html" id="sliderTemplate">
          <div id="slider-current">
            <span class="time"></span>: <span class="layer"></span>
          </div>
          <div id="slider-min"></div><div id="slider"></div><div id="slider-max"></div>
        </script>

        <script type="text/html" id="aboutTemplate">
          <div class="about-container">
            <div>
              <b>NYC Crashmapper</b> lets you browse and analyze several years of
              <a href="http://nypd.openscrape.com" target="_blank">intersection-level collision data</a> on a map of NYC.
            </div>
            <div>
              The slider at the bottom changes which month of data are on
              the map.
            </div>
            <div>
              The buttons on the right change which sorts of collisions
              are colored on the map.  Hover over a button to find out what it
              means.
            </div>
            <div>
              Click on an intersection or bubble to get a breakdown of the sorts
              of collisions that happened there.
            </div>
            <div>
              The buttons on the top left let you change the base map.
            </div>
            <div>
              To share a map, simply copy the location.
            </div>

            <div style="text-align:center;">
              <button type="button" class="ui-widget" id="aboutDismiss" alt="OK" title="OK">OK</button>
            </div>
          </div>
        </script>

        <script type="text/html" id="helpControlTemplate">
          <a href="#help" title="Help" alt="Help">?</a>
        </script>

        <script type="text/html" id="dimensionControlTemplate">
          <a href="#collisions-with-injuries" title="Collisions with Injuries" alt="Collisions with Injuries" data-volume="8">
            <img src="/images/collision-with-injury.png" class="ideograph" />
          </a>
          <a href="#collisions" title="Collisions" alt="Collisions" data-volume="2">
            <img src="/images/collision.png" class="ideograph" />
          </a>
          <a href="#involved" title="People Involved" alt="People Involved" data-volume="1">
            <img src="/images/involved.png" class="ideograph" />
          </a>

          <div class="dimension-spacer">&nbsp;</div>

          <a href="#pedestrians-injured" title="Pedestrians Injured" alt="Pedestrians Injured" data-volume="20">
            <img src="/images/pedestrian.png" class="ideograph" />
          </a>
          <a href="#cyclists-injured" title="Cyclists Injured" alt="Cyclist Injured" data-volume="40">
            <img src="/images/cyclist.png" class="ideograph" />
          </a>
          <a href="#passengers-injured" title="Passengers Injured" alt="Passengers Injured" data-volume="20">
            <img src="/images/passenger.png" class="ideograph" />
          </a>
          <a href="#motorists-injured" title="Motorist" alt="Motorist" data-volume="20">
            <img src="/images/motorist.png" class="ideograph" />
          </a>
        </script>

        <script type="text/html" id="markerTemplate">
          <div class="popup">
            <h3>
                {{#aggregate}}
                  {{count}} intersections near {{streetName}}
                {{/aggregate}}
                {{^aggregate}}
                  {{streetName}}
                {{/aggregate}}
            </h3>
            {{#data}}
            <div class="data">
              <table>
                <tr>
                  <th><img src="/images/collision-with-injury.png" title="Collisions with Injuries" alt="Collisions with Injuries" class="ideograph" /></th>
                  <td>{{collisionsWithInjuries}}</td>
                </tr>
                <tr>
                  <th><img src="/images/collision.png" title="Collisions" alt="Collisions" class="ideograph" /></th>
                  <td>{{collisions}}</td>
                </tr>
                <tr>
                  <th><img src="/images/involved.png" title="People Involved" alt="People Involved" class="ideograph" /></th>
                  <td>{{involved}}</td>
                </tr>
              </table>
              <table>
                <tr>
                  <th></th>
                  <th><img src="/images/pedestrian.png" title="Pedestrian" alt="Pedestrian" class="ideograph" /></th>
                  <th></th><th><img src="/images/cyclist.png" title="Cyclist" alt="Cyclist" class="ideograph" /></th>
                  <th></th><th><img src="/images/passenger.png" title="Passenger" alt="Passenger" class="ideograph" /></th>
                  <th></th><th><img src="/images/motorist.png" title="Motorist" alt="Motorist" class="ideograph" /></th>
                  <th></th><th></th>
                </tr>
                <tr>
                  <th><img src="/images/injured.png" title="Injured" alt="Injured" class="ideograph" /></th>
                  <td>           {{#pedestr}}   {{injured}}{{/pedestr}}   {{^pedestr}}    0{{/pedestr}}</td>
                  <td>+</td><td> {{#cyclists}}  {{injured}}{{/cyclists}}  {{^cyclists}}   0{{/cyclists}}</td>
                  <td>+</td><td> {{#passengers}}{{injured}}{{/passengers}}{{^passengers}} 0{{/passengers}}</td>
                  <td>+</td><td> {{#motorists}} {{injured}}{{/motorists}} {{^motorists}}  0{{/motorists}}</td>
                  <td>=</td><td> {{#total}}     {{injured}}{{/total}}     {{^total}}      0{{/total}}</td>
                </tr>
                <tr>
                  <th><img src="/images/killed.png" title="Killed" alt="Killed" class="ideograph" /></th>
                  <td>           {{#pedestr}}    {{killed}}{{/pedestr}}   {{^pedestr}}    0{{/pedestr}}</td>
                  <td>+</td><td> {{#cyclists}}   {{killed}}{{/cyclists}}  {{^cyclists}}   0{{/cyclists}}</td>
                  <td>+</td><td> {{#passengers}} {{killed}}{{/passengers}}{{^passengers}} 0{{/passengers}}</td>
                  <td>+</td><td> {{#motorists}}  {{killed}}{{/motorists}} {{^motorists}}  0{{/motorists}}</td>
                  <td>=</td><td> {{#total}}      {{killed}}{{/total}}     {{^total}}      0{{/total}}</td>
                </tr>
              </table>
              <!--
              <div>
                {{#other}}
                {{vehicle_count}} {{vehicle_type}}, 
                {{/other}}
              </div>
              -->
            </div>
            {{/data}}
          </div>
        </script>
    </head>

    <body>
        <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/leaflet/0.6.3/leaflet.js"></script>
        <script type="text/javascript" src="/js/lib/leaflet.markercluster.js"></script>
        <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/mustache.js/0.7.2/mustache.min.js"></script>
        <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
        <script type="text/javascript" src="/js/lib/jquery-ui-1.10.3.custom.min.js"></script>
        <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/underscore.js/1.4.4/underscore-min.js"></script>
        <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/backbone.js/1.0.0/backbone-min.js"></script>
        <script type="text/javascript" src="/js/letsmap.js"></script>

        <script>
          (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
          (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
          })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

          ga('create', 'UA-29838172-2', 'crashmapper.com');
          ga('send', 'pageview');

        </script>
    </body>
</html>
